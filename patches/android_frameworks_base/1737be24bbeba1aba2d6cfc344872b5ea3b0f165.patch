From 1737be24bbeba1aba2d6cfc344872b5ea3b0f165 Mon Sep 17 00:00:00 2001
From: Pavel Kirpichyov <pavel.kirpichyov@gmail.com>
Date: Sun, 16 Dec 2012 18:23:14 +0400
Subject: [PATCH] Allow bootanimation to use RGB 565

Change-Id: I4b14d589f56554b6daac9290b50db7120d0bb3ff
---
 cmds/bootanimation/Android.mk        |    5 +++++
 cmds/bootanimation/BootAnimation.cpp |    4 ++++
 2 files changed, 9 insertions(+)

diff --git a/cmds/bootanimation/Android.mk b/cmds/bootanimation/Android.mk
index 8c46b21..e2cb86f 100644
--- a/cmds/bootanimation/Android.mk
+++ b/cmds/bootanimation/Android.mk
@@ -21,6 +21,11 @@ LOCAL_SHARED_LIBRARIES := \
 LOCAL_C_INCLUDES := \
 	$(call include-path-for, corecg graphics)
 
+	
+ifeq ($(TARGET_BOOTANIMATION_USE_RGB565),true)
+    LOCAL_CFLAGS += -DUSE_565
+endif
+
 LOCAL_MODULE:= bootanimation
 
 
diff --git a/cmds/bootanimation/BootAnimation.cpp b/cmds/bootanimation/BootAnimation.cpp
index 8511735..646209e 100644
--- a/cmds/bootanimation/BootAnimation.cpp
+++ b/cmds/bootanimation/BootAnimation.cpp
@@ -162,7 +162,11 @@ status_t BootAnimation::initTexture(void* buffer, size_t len)
     codec->setDitherImage(false);
     if (codec) {
         codec->decode(&stream, &bitmap,
+#ifdef USE_565
+                SkBitmap::kRGB_565_Config,
+#else
                 SkBitmap::kARGB_8888_Config,
+#endif
                 SkImageDecoder::kDecodePixels_Mode);
         delete codec;
     }
-- 
1.7.10

